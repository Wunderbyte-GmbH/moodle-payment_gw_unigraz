{"version":3,"file":"gateways_modal.min.js","sources":["../src/gateways_modal.js"],"sourcesContent":["/* eslint-disable max-len */\n/* eslint-disable no-unused-vars */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module is responsible for unigraz content in the gateways modal.\n *\n * @module     paygw_unigraz/gateway_modal\n * @copyright  2022 Wunderbyte Gmbh <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {exception as displayException} from 'core/notification';\nimport * as Repository from './repository';\nimport Templates from 'core/templates';\nimport Truncate from 'core/truncate';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport {\n    get_string as getString\n} from 'core/str';\n\n/**\n * Creates and shows a modal that contains a placeholder.\n *\n * @returns {Promise<Modal>}\n */\nconst showModalWithPlaceholder = async () => {\n    const modal = await ModalFactory.create({\n        body: await Templates.render('paygw_unigraz/unigraz_button_placeholder', {})\n    });\n    modal.show();\n    return modal;\n};\n\n\n/**\n * Process the payment.\n *\n * @param {string} component Name of the component that the itemId belongs to\n * @param {string} paymentArea The area of the component that the itemId belongs to\n * @param {number} itemId An internal identifier that is used by the component\n * @param {string} description Description of the payment\n * @returns {Promise<string>}\n */\nexport const process = (component, paymentArea, itemId, description) => {\n    return Promise.all([\n            showModalWithPlaceholder(),\n            Repository.getConfigForJs(component, paymentArea, itemId),\n        ])\n        .then(([modal, unigrazConfig]) => {\n            return Promise.all([\n                modal,\n                unigrazConfig,\n            ]);\n        })\n        .then(([modal, unigrazConfig]) => {\n\n            const providersjson = JSON.parse(unigrazConfig.providerobject);\n            const optionsel = document.createElement('div');\n\n            const context = {\n                listofproviders: providersjson.object,\n                cartid: unigrazConfig.cartid,\n                component,\n                paymentarea: paymentArea,\n                itemid: itemId,\n            };\n\n\n            Templates.renderForPromise('paygw_unigraz/paymentoptions', context).then(({html, js}) => {\n                    Templates.appendNodeContents(optionsel, html, js);\n                    modal.setBody(optionsel);\n                    return true;\n                }).catch();\n\n            return '';\n\n        }).then(x => {\n            const promise = new Promise(resolve => {\n                window.addEventListener('onbeforeunload', (e) => {\n                    promise.resolve();\n                });\n            });\n            return promise;\n        });\n};"],"names":["showModalWithPlaceholder","async","modal","ModalFactory","create","body","Templates","render","show","component","paymentArea","itemId","description","Promise","all","Repository","getConfigForJs","then","_ref","unigrazConfig","_ref2","providersjson","JSON","parse","providerobject","optionsel","document","createElement","context","listofproviders","object","cartid","paymentarea","itemid","renderForPromise","_ref3","html","js","appendNodeContents","setBody","catch","x","promise","resolve","window","addEventListener","e"],"mappings":";;;;;;;4NAwCMA,yBAA2BC,gBACvBC,YAAcC,uBAAaC,OAAO,CACpCC,WAAYC,mBAAUC,OAAO,2CAA4C,aAE7EL,MAAMM,OACCN,wBAaY,CAACO,UAAWC,YAAaC,OAAQC,cAC7CC,QAAQC,IAAI,CACXd,2BACAe,WAAWC,eAAeP,UAAWC,YAAaC,UAErDM,MAAKC,WAAEhB,MAAOiB,2BACJN,QAAQC,IAAI,CACfZ,MACAiB,mBAGPF,MAAKG,YAAElB,MAAOiB,2BAELE,cAAgBC,KAAKC,MAAMJ,cAAcK,gBACzCC,UAAYC,SAASC,cAAc,OAEnCC,QAAU,CACZC,gBAAiBR,cAAcS,OAC/BC,OAAQZ,cAAcY,OACtBtB,UAAAA,UACAuB,YAAatB,YACbuB,OAAQtB,kCAIFuB,iBAAiB,+BAAgCN,SAASX,MAAKkB,YAACC,KAACA,KAADC,GAAOA,oCAC/DC,mBAAmBb,UAAWW,KAAMC,IAC9CnC,MAAMqC,QAAQd,YACP,KACRe,QAEA,MAERvB,MAAKwB,UACEC,QAAU,IAAI7B,SAAQ8B,UACxBC,OAAOC,iBAAiB,kBAAmBC,IACvCJ,QAAQC,uBAGTD"}